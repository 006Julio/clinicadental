<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odontograma - Anatom√≠a Dental</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 50%, #e8f5e8 100%);
            min-height: 100vh;
            padding: 15px;
            color: #424242;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .header {
            background: linear-gradient(135deg, #a5d8ff 0%, #b5e4ca 100%);
            color: #212121;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            font-weight: 300;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        .controles {
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            border-bottom: 1px solid #e0e0e0;
        }

        .boton-tratamiento {
            padding: 14px 24px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            color: white;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .boton-tratamiento::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s;
        }

        .boton-tratamiento:hover::before {
            left: 100%;
        }

        .boton-tratamiento:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .boton-tratamiento.activo {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
            50% { box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
            100% { box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        }

        /* Colores pastel para tratamientos */
        .caries { background: linear-gradient(135deg, #f48fb1, #ec407a); }
        .obturacion { background: linear-gradient(135deg, #81c784, #4caf50); }
        .corona { background: linear-gradient(135deg, #ffb74d, #ffa726); }
        .endodoncia { background: linear-gradient(135deg, #9575cd, #7e57c2); }
        .implante { background: linear-gradient(135deg, #b0bec5, #78909c); }
        .extraccion { background: linear-gradient(135deg, #ef9a9a, #e57373); }
        .limpiar { background: linear-gradient(135deg, #cfd8dc, #90a4ae); }

        .odontograma-container {
            padding: 40px;
            background: #fafafa;
        }

        .odontograma {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .arcada {
            display: flex;
            gap: 8px;
            align-items: flex-end;
            flex-wrap: wrap;
            justify-content: center;
        }

        .arcada.superior {
            align-items: flex-end;
        }

        .arcada.inferior {
            align-items: flex-start;
            flex-direction: row-reverse;
        }

        .diente-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: all 0.4s ease;
            position: relative;
        }

        .diente-wrapper:hover {
            transform: scale(1.08);
            z-index: 10;
        }

        .numero-diente {
            font-weight: bold;
            color: #5d6d7e;
            font-size: 13px;
            background: linear-gradient(135deg, #d4e6f1, #f0f5f9);
            padding: 6px 10px;
            border-radius: 15px;
            min-width: 28px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #bdc3c7;
        }

        .diente {
            cursor: pointer;
            filter: drop-shadow(2px 2px 6px rgba(0,0,0,0.1));
            transition: all 0.3s ease;
            position: relative;
        }

        .diente:hover {
            filter: drop-shadow(4px 4px 12px rgba(0,0,0,0.15));
        }

        /* Superficies del diente */
        .superficie-oclusal, 
        .superficie-vestibular, 
        .superficie-lingual, 
        .superficie-mesial, 
        .superficie-distal, 
        .raiz-dental {
            transition: all 0.3s ease;
            stroke: #566573;
            stroke-width: 1.1;
        }

        .superficie-oclusal:hover, 
        .superficie-vestibular:hover, 
        .superficie-lingual:hover, 
        .superficie-mesial:hover, 
        .superficie-distal:hover, 
        .raiz-dental:hover {
            stroke-width: 2.2;
            stroke: #3498db;
            filter: brightness(1.1);
        }

        .info-panel {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #fffde7, #f3e5f5);
            border-radius: 20px;
            text-align: center;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .diente-seleccionado {
            font-weight: 700;
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 15px;
        }

        .tratamientos-aplicados {
            color: #6c757d;
            font-size: 15px;
            line-height: 1.6;
        }

        .estadisticas {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            padding: 15px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            min-width: 90px;
            border: 1px solid #e0e0e0;
            transition: transform 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 800;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 11px;
            color: #7f8c8d;
            text-transform: uppercase;
            font-weight: 600;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .arcada {
                gap: 4px;
            }
            
            .diente {
                transform: scale(0.75);
            }

            .controles {
                gap: 6px;
                padding: 15px;
            }

            .boton-tratamiento {
                padding: 10px 16px;
                font-size: 12px;
            }

            .estadisticas {
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü¶∑ Odontograma Cl√≠nico</h1>
        </div>

        <div class="controles">
            <button class="boton-tratamiento caries" data-tratamiento="caries">
                ü©∏ Caries
            </button>
            <button class="boton-tratamiento obturacion" data-tratamiento="obturacion">
                üõ†Ô∏è Obturaci√≥n
            </button>
            <button class="boton-tratamiento corona" data-tratamiento="corona">
                üëë Corona
            </button>
            <button class="boton-tratamiento endodoncia" data-tratamiento="endodoncia">
                üß† Endodoncia
            </button>
            <button class="boton-tratamiento implante" data-tratamiento="implante">
                ‚öôÔ∏è Implante
            </button>
            <button class="boton-tratamiento extraccion" data-tratamiento="extraccion">
                ‚ùå Extracci√≥n
            </button>
            <button class="boton-tratamiento limpiar" data-tratamiento="limpiar">
                üßº Limpiar
            </button>
        </div>

        <div class="odontograma-container">
            <div class="odontograma">
                <div class="arcada superior" id="arcada-superior"></div>
                <div class="arcada inferior" id="arcada-inferior"></div>
            </div>

            <div class="info-panel">
                <div class="diente-seleccionado" id="info-diente">
                    Sistema de diagn√≥stico dental activado ‚ú®
                </div>
                <div class="tratamientos-aplicados" id="info-tratamientos">
                    Selecciona un tratamiento y haz clic en la superficie espec√≠fica del diente
                </div>

                <div class="estadisticas">
                    <div class="stat-item">
                        <div class="stat-number" id="stat-caries">0</div>
                        <div class="stat-label">Caries</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-obturaciones">0</div>
                        <div class="stat-label">Obturaciones</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-coronas">0</div>
                        <div class="stat-label">Coronas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-endodoncias">0</div>
                        <div class="stat-label">Endodoncias</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-implantes">0</div>
                        <div class="stat-label">Implantes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-total">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class OdontogramaUltraRealista {
            constructor() {
                this.tratamientoActivo = null;
                this.estadoDientes = {};
                this.coloresTratamientos = {
                    'caries': '#f48fb1',         // Rosa pastel
                    'obturacion': '#81c784',     // Verde menta
                    'corona': '#ffb74d',         // Naranja suave
                    'endodoncia': '#9575cd',     // Lavanda
                    'implante': '#b0bec5',       // Gris azulado pastel
                    'extraccion': '#ef9a9a',     // Rojo claro
                    'limpiar': '#ffffff'
                };
                
                this.dientesSuperiores = [18, 17, 16, 15, 14, 13, 12, 11, 21, 22, 23, 24, 25, 26, 27, 28];
                this.dientesInferiores = [48, 47, 46, 45, 44, 43, 42, 41, 31, 32, 33, 34, 35, 36, 37, 38];
                
                this.pathsAnatomicos = this.inicializarPathsAnatomicos();
                
                this.inicializar();
            }

            inicializarPathsAnatomicos() {
                return {
                    incisivo_central: {
                        corona_vestibular: 'M15,25 C12,22 12,18 15,15 L30,15 C33,18 33,22 30,25 L30,40 C30,43 27,45 23,45 L22,45 C18,45 15,43 15,40 Z',
                        corona_lingual: 'M15,40 C15,43 18,45 22,45 L23,45 C27,45 30,43 30,40 L33,43 L33,50 C33,53 30,55 26,55 L19,55 C15,55 12,53 12,50 L12,43 Z',
                        superficie_oclusal: 'M15,25 L30,25 L30,40 L15,40 Z',
                        superficie_mesial: 'M12,43 L15,40 L15,25 C12,22 12,18 15,15 L15,12 L12,15 C9,18 9,25 12,43 Z',
                        superficie_distal: 'M33,43 L30,40 L30,25 C33,22 33,18 30,15 L30,12 L33,15 C36,18 36,25 33,43 Z',
                        raiz: 'M18,45 L27,45 L25,75 C25,78 24,80 22.5,80 C21,80 20,78 20,75 Z'
                    },
                    incisivo_lateral: {
                        corona_vestibular: 'M16,28 C14,25 14,22 16,19 L29,19 C31,22 31,25 29,28 L29,42 C29,44 27,46 25,46 L20,46 C18,46 16,44 16,42 Z',
                        corona_lingual: 'M16,42 C16,44 18,46 20,46 L25,46 C27,46 29,44 29,42 L31,45 L31,51 C31,53 29,55 26,55 L19,55 C16,55 14,53 14,51 L14,45 Z',
                        superficie_oclusal: 'M16,28 L29,28 L29,42 L16,42 Z',
                        superficie_mesial: 'M14,45 L16,42 L16,28 C14,25 14,22 16,19 L16,17 L14,20 C12,23 12,28 14,45 Z',
                        superficie_distal: 'M31,45 L29,42 L29,28 C31,25 31,22 29,19 L29,17 L31,20 C33,23 33,28 31,45 Z',
                        raiz: 'M19,46 L26,46 L24,76 C24,78 23,79 22.5,79 C22,79 21,78 21,76 Z'
                    },
                    canino: {
                        corona_vestibular: 'M17,30 C15,27 15,23 17,18 L28,18 C30,23 30,27 28,30 L28,44 C28,46 26,48 24,48 L21,48 C19,48 17,46 17,44 Z',
                        corona_lingual: 'M17,44 C17,46 19,48 21,48 L24,48 C26,48 28,46 28,44 L30,47 L30,53 C30,55 28,57 25,57 L20,57 C17,57 15,55 15,53 L15,47 Z',
                        superficie_oclusal: 'M17,30 L28,30 L26,35 L22.5,32 L19,35 Z',
                        superficie_mesial: 'M15,47 L17,44 L17,30 C15,27 15,23 17,18 L17,15 L15,20 C13,25 13,32 15,47 Z',
                        superficie_distal: 'M30,47 L28,44 L28,30 C30,27 30,23 28,18 L28,15 L30,20 C32,25 32,32 30,47 Z',
                        raiz: 'M19,48 L26,48 L25,82 C25,84 24,85 22.5,85 C21,85 20,84 20,82 Z'
                    },
                    premolar: {
                        corona_vestibular: 'M14,32 C12,29 12,25 14,22 L31,22 C33,25 33,29 31,32 L31,46 C31,48 29,50 27,50 L18,50 C16,50 14,48 14,46 Z',
                        corona_lingual: 'M14,46 C14,48 16,50 18,50 L27,50 C29,50 31,48 31,46 L33,49 L33,55 C33,57 31,59 28,59 L17,59 C14,59 12,57 12,55 L12,49 Z',
                        superficie_oclusal: 'M14,32 L31,32 L29,37 L25,35 L22.5,37 L20,35 L16,37 Z',
                        superficie_mesial: 'M12,49 L14,46 L14,32 C12,29 12,25 14,22 L14,19 L12,24 C10,29 10,37 12,49 Z',
                        superficie_distal: 'M33,49 L31,46 L31,32 C33,29 33,25 31,22 L31,19 L33,24 C35,29 35,37 33,49 Z',
                        raiz: 'M16,50 L29,50 L27,78 C27,80 26,81 22.5,81 C19,81 18,80 18,78 Z'
                    },
                    molar: {
                        corona_vestibular: 'M10,35 C8,32 8,28 10,25 L35,25 C37,28 37,32 35,35 L35,49 C35,51 33,53 31,53 L14,53 C12,53 10,51 10,49 Z',
                        corona_lingual: 'M10,49 C10,51 12,53 14,53 L31,53 C33,53 35,51 35,49 L37,52 L37,58 C37,60 35,62 32,62 L13,62 C10,62 8,60 8,58 L8,52 Z',
                        superficie_oclusal: 'M10,35 L35,35 L33,40 L28,38 L25,40 L22.5,38 L20,40 L17,38 L12,40 Z',
                        superficie_mesial: 'M8,52 L10,49 L10,35 C8,32 8,28 10,25 L10,22 L8,27 C6,32 6,42 8,52 Z',
                        superficie_distal: 'M37,52 L35,49 L35,35 C37,32 37,28 35,25 L35,22 L37,27 C39,32 39,42 37,52 Z',
                        raiz_mesial: 'M12,53 L23,53 L21,79 C21,81 20,82 19,82 C18,82 17,81 17,79 Z',
                        raiz_distal: 'M23,53 L33,53 L28,79 C28,81 27,82 26,82 C25,82 24,81 24,79 Z'
                    }
                };
            }

            // ... (el resto del script permanece igual, no se modifica)
            inicializar() {
                this.crearDientes();
                this.configurarEventos();
                this.actualizarEstadisticas();
            }

            crearDientes() {
                this.crearArcada('arcada-superior', this.dientesSuperiores, false);
                this.crearArcada('arcada-inferior', this.dientesInferiores, true);
            }

            crearArcada(containerId, numeroDientes, esInferior) {
                const container = document.getElementById(containerId);
                
                numeroDientes.forEach(numero => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'diente-wrapper';
                    
                    const numeroDiv = document.createElement('div');
                    numeroDiv.className = 'numero-diente';
                    numeroDiv.textContent = numero;
                    
                    const svg = this.crearSVGDienteRealista(numero, esInferior);
                    
                    if (esInferior) {
                        wrapper.appendChild(svg);
                        wrapper.appendChild(numeroDiv);
                    } else {
                        wrapper.appendChild(numeroDiv);
                        wrapper.appendChild(svg);
                    }
                    
                    container.appendChild(wrapper);
                    this.estadoDientes[numero] = {};
                });
            }

            crearSVGDienteRealista(numero, esInferior) {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '50');
                svg.setAttribute('height', '90');
                svg.setAttribute('viewBox', '0 0 50 90');
                svg.setAttribute('class', 'diente');
                svg.setAttribute('data-numero', numero);

                const ultimoDigito = numero % 10;
                let tipoDiente, paths;

                if (ultimoDigito === 1) {
                    tipoDiente = 'incisivo_central';
                } else if (ultimoDigito === 2) {
                    tipoDiente = 'incisivo_lateral';
                } else if (ultimoDigito === 3) {
                    tipoDiente = 'canino';
                } else if (ultimoDigito === 4 || ultimoDigito === 5) {
                    tipoDiente = 'premolar';
                } else {
                    tipoDiente = 'molar';
                }

                paths = this.pathsAnatomicos[tipoDiente];

                this.crearSuperficie(svg, paths.corona_vestibular, 'superficie-vestibular', 'vestibular', numero, '#ffffff');
                this.crearSuperficie(svg, paths.corona_lingual, 'superficie-lingual', 'lingual', numero, '#f8f8f8');
                this.crearSuperficie(svg, paths.superficie_oclusal, 'superficie-oclusal', 'oclusal', numero, '#ffffff');
                
                if (paths.superficie_mesial) {
                    this.crearSuperficie(svg, paths.superficie_mesial, 'superficie-mesial', 'mesial', numero, '#fafafa');
                }
                if (paths.superficie_distal) {
                    this.crearSuperficie(svg, paths.superficie_distal, 'superficie-distal', 'distal', numero, '#fafafa');
                }

                if (tipoDiente === 'molar' && paths.raiz_mesial && paths.raiz_distal) {
                    this.crearSuperficie(svg, paths.raiz_mesial, 'raiz-dental', 'raiz_mesial', numero, '#f0f0f0');
                    this.crearSuperficie(svg, paths.raiz_distal, 'raiz-dental', 'raiz_distal', numero, '#f0f0f0');
                } else if (paths.raiz) {
                    this.crearSuperficie(svg, paths.raiz, 'raiz-dental', 'raiz', numero, '#f0f0f0');
                }

                return svg;
            }

            crearSuperficie(svg, path, className, superficie, numero, color) {
                const elemento = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                elemento.setAttribute('d', path);
                elemento.setAttribute('fill', color);
                elemento.setAttribute('class', className);
                elemento.setAttribute('data-superficie', superficie);
                elemento.setAttribute('data-numero', numero);
                
                elemento.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.aplicarTratamiento(numero, superficie, elemento);
                });

                svg.appendChild(elemento);
            }

            configurarEventos() {
                const botones = document.querySelectorAll('.boton-tratamiento');
                botones.forEach(boton => {
                    boton.addEventListener('click', () => {
                        this.seleccionarTratamiento(boton.dataset.tratamiento);
                        this.actualizarBotonesActivos(boton);
                    });
                });
            }

            seleccionarTratamiento(tratamiento) {
                this.tratamientoActivo = tratamiento;
                this.actualizarInfoPanel(null, null, `Tratamiento seleccionado: ${tratamiento.toUpperCase()}`);
            }

            actualizarBotonesActivos(botonActivo) {
                const botones = document.querySelectorAll('.boton-tratamiento');
                botones.forEach(boton => {
                    boton.classList.remove('activo');
                });
                botonActivo.classList.add('activo');
            }

            aplicarTratamiento(numero, superficie, elemento) {
                if (!this.tratamientoActivo) {
                    this.actualizarInfoPanel(numero, superficie, 'Selecciona un tratamiento primero');
                    return;
                }

                if (!this.estadoDientes[numero]) {
                    this.estadoDientes[numero] = {};
                }

                if (this.tratamientoActivo === 'limpiar') {
                    delete this.estadoDientes[numero][superficie];
                    elemento.setAttribute('fill', this.obtenerColorOriginal(superficie));
                } else {
                    this.estadoDientes[numero][superficie] = this.tratamientoActivo;
                    elemento.setAttribute('fill', this.coloresTratamientos[this.tratamientoActivo]);
                }

                this.actualizarInfoPanel(numero, superficie, this.tratamientoActivo);
                this.actualizarEstadisticas();
            }

            obtenerColorOriginal(superficie) {
                const colores = {
                    'vestibular': '#ffffff',
                    'lingual': '#f8f8f8',
                    'oclusal': '#ffffff',
                    'mesial': '#fafafa',
                    'distal': '#fafafa',
                    'raiz': '#f0f0f0',
                    'raiz_mesial': '#f0f0f0',
                    'raiz_distal': '#f0f0f0'
                };
                return colores[superficie] || '#ffffff';
            }

            actualizarInfoPanel(numero, superficie, mensaje) {
                const infoDiente = document.getElementById('info-diente');
                const infoTratamientos = document.getElementById('info-tratamientos');

                if (numero && superficie) {
                    const nombreSuperficie = this.obtenerNombreSuperficie(superficie);
                    const tipoDiente = this.obtenerTipoDiente(numero);
                    
                    infoDiente.textContent = `Diente ${numero} - ${tipoDiente}`;
                    
                    const tratamientosDiente = this.estadoDientes[numero] || {};
                    const tratamientosTexto = Object.entries(tratamientosDiente).map(([sup, trat]) => {
                        return `${this.obtenerNombreSuperficie(sup)}: ${trat.toUpperCase()}`;
                    }).join(' | ');

                    if (tratamientosTexto) {
                        infoTratamientos.innerHTML = `
                            <strong>Superficie seleccionada:</strong> ${nombreSuperficie}<br>
                            <strong>Tratamientos aplicados:</strong> ${tratamientosTexto}
                        `;
                    } else {
                        infoTratamientos.innerHTML = `
                            <strong>Superficie seleccionada:</strong> ${nombreSuperficie}<br>
                            <em>Sin tratamientos aplicados</em>
                        `;
                    }
                } else if (mensaje) {
                    infoDiente.textContent = mensaje;
                    infoTratamientos.textContent = 'Haz clic en una superficie espec√≠fica del diente para aplicar el tratamiento';
                }
            }

            obtenerNombreSuperficie(superficie) {
                const nombres = {
                    'vestibular': 'Superficie Vestibular',
                    'lingual': 'Superficie Lingual',
                    'oclusal': 'Superficie Oclusal',
                    'mesial': 'Superficie Mesial',
                    'distal': 'Superficie Distal',
                    'raiz': 'Ra√≠z',
                    'raiz_mesial': 'Ra√≠z Mesial',
                    'raiz_distal': 'Ra√≠z Distal'
                };
                return nombres[superficie] || superficie;
            }

            obtenerTipoDiente(numero) {
                const ultimoDigito = numero % 10;
                const cuadrante = Math.floor(numero / 10);
                
                let tipo = '';
                if (ultimoDigito === 1) tipo = 'Incisivo Central';
                else if (ultimoDigito === 2) tipo = 'Incisivo Lateral';
                else if (ultimoDigito === 3) tipo = 'Canino';
                else if (ultimoDigito === 4) tipo = 'Primer Premolar';
                else if (ultimoDigito === 5) tipo = 'Segundo Premolar';
                else if (ultimoDigito === 6) tipo = 'Primer Molar';
                else if (ultimoDigito === 7) tipo = 'Segundo Molar';
                else if (ultimoDigito === 8) tipo = 'Tercer Molar (Cordal)';

                let posicion = '';
                if (cuadrante === 1) posicion = 'Superior Derecho';
                else if (cuadrante === 2) posicion = 'Superior Izquierdo';
                else if (cuadrante === 3) posicion = 'Inferior Izquierdo';
                else if (cuadrante === 4) posicion = 'Inferior Derecho';

                return `${tipo} (${posicion})`;
            }

            actualizarEstadisticas() {
                const stats = {
                    caries: 0,
                    obturacion: 0,
                    corona: 0,
                    endodoncia: 0,
                    implante: 0,
                    extraccion: 0
                };

                Object.values(this.estadoDientes).forEach(diente => {
                    Object.values(diente).forEach(tratamiento => {
                        if (stats.hasOwnProperty(tratamiento)) {
                            stats[tratamiento]++;
                        }
                    });
                });

                document.getElementById('stat-caries').textContent = stats.caries;
                document.getElementById('stat-obturaciones').textContent = stats.obturacion;
                document.getElementById('stat-coronas').textContent = stats.corona;
                document.getElementById('stat-endodoncias').textContent = stats.endodoncia;
                document.getElementById('stat-implantes').textContent = stats.implante;
                
                const total = Object.values(stats).reduce((sum, val) => sum + val, 0);
                document.getElementById('stat-total').textContent = total;
            }

            exportarDatos() {
                const datos = {
                    fecha: new Date().toISOString(),
                    estadoDientes: this.estadoDientes,
                    version: '1.0'
                };
                return JSON.stringify(datos, null, 2);
            }

            importarDatos(datosJSON) {
                try {
                    const datos = JSON.parse(datosJSON);
                    this.estadoDientes = datos.estadoDientes || {};
                    
                    Object.entries(this.estadoDientes).forEach(([numero, superficies]) => {
                        Object.entries(superficies).forEach(([superficie, tratamiento]) => {
                            const elemento = document.querySelector(`[data-numero="${numero}"][data-superficie="${superficie}"]`);
                            if (elemento) {
                                elemento.setAttribute('fill', this.coloresTratamientos[tratamiento]);
                            }
                        });
                    });
                    
                    this.actualizarEstadisticas();
                    this.actualizarInfoPanel(null, null, 'Datos importados correctamente');
                    
                    return true;
                } catch (error) {
                    console.error('Error al importar datos:', error);
                    this.actualizarInfoPanel(null, null, 'Error al importar datos');
                    return false;
                }
            }

            limpiarTodo() {
                this.estadoDientes = {};
                
                document.querySelectorAll('[data-superficie]').forEach(elemento => {
                    const superficie = elemento.dataset.superficie;
                    elemento.setAttribute('fill', this.obtenerColorOriginal(superficie));
                });
                
                this.actualizarEstadisticas();
                this.actualizarInfoPanel(null, null, 'Odontograma limpiado completamente');
            }

            generarReporte() {
                const reporte = {
                    fecha: new Date().toLocaleString(),
                    totalTratamientos: 0,
                    dientesAfectados: 0,
                    detallesPorDiente: {},
                    resumenTratamientos: {
                        caries: 0,
                        obturacion: 0,
                        corona: 0,
                        endodoncia: 0,
                        implante: 0,
                        extraccion: 0
                    }
                };

                Object.entries(this.estadoDientes).forEach(([numero, superficies]) => {
                    if (Object.keys(superficies).length > 0) {
                        reporte.dientesAfectados++;
                        reporte.detallesPorDiente[numero] = {
                            tipoDiente: this.obtenerTipoDiente(parseInt(numero)),
                            tratamientos: {}
                        };

                        Object.entries(superficies).forEach(([superficie, tratamiento]) => {
                            reporte.totalTratamientos++;
                            reporte.resumenTratamientos[tratamiento]++;
                            reporte.detallesPorDiente[numero].tratamientos[superficie] = tratamiento;
                        });
                    }
                });

                return reporte;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const odontograma = new OdontogramaUltraRealista();
            window.odontograma = odontograma;
        });

        function descargarDatos() {
            const datos = window.odontograma.exportarDatos();
            const blob = new Blob([datos], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `odontograma-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function cargarDatos() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        window.odontograma.importarDatos(e.target.result);
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function imprimirReporte() {
            const reporte = window.odontograma.generarReporte();
            const ventana = window.open('', '_blank');
            ventana.document.write(`
                <html>
                <head>
                    <title>Reporte Odontograma</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; background: #fcfcfc; }
                        h1, h2 { color: #424242; }
                        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #f0f0f0; }
                        .resumen { background-color: #f8f9fa; padding: 15px; border-radius: 8px; }
                    </style>
                </head>
                <body>
                    <h1>ü¶∑ Reporte Odontol√≥gico</h1>
                    <div class="resumen">
                        <p><strong>Fecha:</strong> ${reporte.fecha}</p>
                        <p><strong>Dientes afectados:</strong> ${reporte.dientesAfectados}</p>
                        <p><strong>Total de tratamientos:</strong> ${reporte.totalTratamientos}</p>
                    </div>
                    
                    <h2>Resumen de Tratamientos</h2>
                    <table>
                        <tr><th>Tratamiento</th><th>Cantidad</th></tr>
                        <tr><td>Caries</td><td>${reporte.resumenTratamientos.caries}</td></tr>
                        <tr><td>Obturaciones</td><td>${reporte.resumenTratamientos.obturacion}</td></tr>
                        <tr><td>Coronas</td><td>${reporte.resumenTratamientos.corona}</td></tr>
                        <tr><td>Endodoncias</td><td>${reporte.resumenTratamientos.endodoncia}</td></tr>
                        <tr><td>Implantes</td><td>${reporte.resumenTratamientos.implante}</td></tr>
                        <tr><td>Extracciones</td><td>${reporte.resumenTratamientos.extraccion}</td></tr>
                    </table>

                    <h2>Detalles por Diente</h2>
                    ${Object.entries(reporte.detallesPorDiente).map(([numero, detalle]) => `
                        <h3>Diente ${numero} - ${detalle.tipoDiente}</h3>
                        <ul>
                            ${Object.entries(detalle.tratamientos).map(([superficie, tratamiento]) => 
                                `<li>${superficie}: <strong>${tratamiento.toUpperCase()}</strong></li>`
                            ).join('')}
                        </ul>
                    `).join('')}
                </body>
                </html>
            `);
            ventana.document.close();
            ventana.focus();
            ventana.print();
        }

        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 's': e.preventDefault(); descargarDatos(); break;
                    case 'o': e.preventDefault(); cargarDatos(); break;
                    case 'p': e.preventDefault(); imprimirReporte(); break;
                    case 'r': e.preventDefault(); window.odontograma.limpiarTodo(); break;
                }
            }
        });
    </script>
</body>
</html>